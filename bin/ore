#!/usr/bin/env ruby

require_relative '../lib/ore'

INSTRUCTIONS = <<~INST
    Usage:
        bundle exec bin/ore <file.ore>          - Run once
        bundle exec bin/ore dev <file.ore>      - Run with hot reload
        bundle exec bin/ore lex "<code>"        - Produce Lexer output for given code
        bundle exec bin/ore parse "<code>"      - Produce Parser output for given code
        bundle exec bin/ore interp "<code>"     - Produce Interpreter output for given code
INST

if ARGV.empty?
	puts INSTRUCTIONS
	exit 1
end

begin
	case ARGV[0]
	when 'dev'
		if ARGV[1]
			puts Ore.interp_file_with_hot_reload ARGV[1]
		else
			puts "Error: No file specified.\n#{INSTRUCTIONS}"
			exit 1
		end
	when 'lex'
		pp Ore.lex ARGV[1]
	when 'parse'
		pp Ore.parse ARGV[1]
	when 'interp'
		pp Ore.interp ARGV[1]
	else
		if ARGV[0]
			puts Ore.interp_file ARGV[0]
		else
			puts "Error: No file specified.\n#{INSTRUCTIONS}"
			exit 1
		end
	end
rescue Ore::Error => e
	$stderr.puts e.message
	exit 1
end
