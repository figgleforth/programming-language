#!/usr/bin/env ruby

require_relative '../src/ore'

INSTRUCTIONS = <<~INST
    Usage:
        ore <file>                  Execute code file
        ore [command]               Run command

    COMMANDS:
        lex <code>                  Show lexer tokens for code
        lexf <file>                 Show lexer tokens for file

        parse <code>                Show AST for code
        parsef <file>               Show AST for file

        interp <code>               Execute code string
        interpf <file>              Execute file

        -v | --version              Show version number
        -h | --help                 Show help instructions

    EXAMPLES:
        ore myapp.ore
        ore lex "x = 5 + 3"
        ore parse -f test.ore
        ore interp myapp.ore
INST

if ARGV.empty?
	puts INSTRUCTIONS
	exit 1
end

begin
	case ARGV[0]
	when '-v', '--version'
		puts "Ore #{Ore::VERSION}"
		exit 0
	when '-h', '--help'
		puts INSTRUCTIONS
		exit 0
	when 'lex'
		pp Ore.lex ARGV[1]
	when 'parse'
		pp Ore.parse ARGV[1]
	when 'interp'
		pp Ore.interp ARGV[1]
	when 'lexf'
		pp Ore.lex_file ARGV[1]
	when 'parsef'
		pp Ore.parse_file ARGV[1]
	when 'interpf'
		pp Ore.interp_file ARGV[1]
	when 'interp-nostd'
		pp Ore.interp ARGV[1], with_std: false
	when 'interpf-nostd'
		pp Ore.interp_file ARGV[1], with_std: false
	else
		if ARGV[0]
			puts Ore.interp_file_with_hot_reload ARGV[0]
		else
			puts "Error: No file specified.\n#{INSTRUCTIONS}"
			exit 1
		end
	end
rescue Errno::ENOENT => e
	$stderr.puts "Could not find file `#{ARGV[0]}`\n\n#{e.full_message}"
	exit 1

rescue Ore::Error => e
	$stderr.puts e.message
	exit 1
end
